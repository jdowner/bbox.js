<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>bbox test</title>
  </head>
  <link rel="stylesheet" href="css/qunit-1.14.0.css">
  <script src="src/bbox.js"></script>
  <script src="lib/qunit-1.14.0.js"></script>
  <body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
  </body>
  <script>
    test("smoke-test", function(){
      ok(true)
    })

    module("qroots");

    test("x^2 + 2 x + 1", function(){
      var a = 1;
      var b = 2;
      var c = 1;

      var roots = bbox.qroots(a, b, c);

      equal(1, roots.length);
      equal(-1, roots[0]);
    })

    test("x^2 + 3 x + 2", function(){
      // (x + 1)(x + 2)
      var a = 1;
      var b = 3;
      var c = 2;

      var roots = bbox.qroots(a, b, c);

      equal(2, roots.length);
      equal(-2, roots[0]);
      equal(-1, roots[1]);
    })

    test("x^2 - x - 2", function(){
      // (x + 1)(x - 2)
      var a = 1;
      var b = -1;
      var c = -2;

      var roots = bbox.qroots(a, b, c);

      equal(2, roots.length);
      equal(-1, roots[0]);
      equal(2, roots[1]);
    })

    test("2 x^2 - x - 1", function(){
      // (2 x + 1)(x - 1)
      var a = 2;
      var b = -1;
      var c = -1;

      var roots = bbox.qroots(a, b, c);

      equal(2, roots.length);
      equal(-0.5, roots[0]);
      equal(1.0, roots[1]);
    })


    module("inflection points");

    test("#1", function(){
      var bezier = {
        x0: 0,
        y0: 0,
        x1: 0,
        y1: 1,
        x2: 1,
        y2: 1,
        x3: 1,
        y3: 0
      };

      var pts = bbox.inflection_points(bezier);

      equal(pts.length, 1);
      ok(Math.abs(bbox.bezier_derivative(bezier, pts[0]).dy) < 1.0e-8);
    })

    test("#2", function(){
      var bezier = {
        x0: 0,
        y0: 0,
        x1: 0,
        y1: -1,
        x2: 1,
        y2: 1,
        x3: 1,
        y3: 0
      };

      var pts = bbox.inflection_points(bezier);

      equal(pts.length, 2);

      ok(Math.abs(bbox.bezier_derivative(bezier, pts[0]).dy) < 1.0e-8);
      ok(Math.abs(bbox.bezier_derivative(bezier, pts[1]).dy) < 1.0e-8);
    })

    test("#3", function(){
      var bezier = {
        x0: 0,
        y0: 0,
        x1: 1,
        y1: -1,
        x2: 0,
        y2: 1,
        x3: 1,
        y3: 0
      };

      var pts = bbox.inflection_points(bezier);

      equal(pts.length, 3);

      ok(Math.abs(bbox.bezier_derivative(bezier, pts[0]).dy) < 1.0e-8);
      ok(Math.abs(bbox.bezier_derivative(bezier, pts[1]).dx) < 1.0e-8);
      ok(Math.abs(bbox.bezier_derivative(bezier, pts[2]).dy) < 1.0e-8);
    })


    module("cubic bezier bounding box")

    test("#1", function(){
      var bezier = {
        x0: 0,
        y0: 0,
        x1: 0,
        y1: 1,
        x2: 1,
        y2: 1,
        x3: 1,
        y3: 0
      };

      var box = bbox.cubic_bezier(bezier);

      equal(box.x, 0);
      equal(box.y, 0);
      equal(box.w, 1);
      equal(box.h, 0.75);
    })

    test("#1 - scaled", function(){
      var bezier = {
        x0: 0,
        y0: 0,
        x1: 0,
        y1: 2,
        x2: 2,
        y2: 2,
        x3: 2,
        y3: 0
      };

      var box = bbox.cubic_bezier(bezier);

      equal(box.x, 0);
      equal(box.y, 0);
      equal(box.w, 2);
      equal(box.h, 1.5);
    })

    test("#1 - shifted", function(){
      var bezier = {
        x0: 5,
        y0: -1,
        x1: 5,
        y1: 0,
        x2: 6,
        y2: 0,
        x3: 6,
        y3: -1
      };

      var box = bbox.cubic_bezier(bezier);

      equal(box.x, 5);
      equal(box.y, -1);
      equal(box.w, 1);
      equal(box.h, 0.75);
    })

    test("#2", function(){
      var bezier = {
        x0: 3,
        y0: 4,
        x1: 2,
        y1: 5,
        x2: 5,
        y2: 5,
        x3: 4,
        y3: 4
      };

      var pts = bbox.inflection_points(bezier);

      equal(pts.length, 3);

      pts.push(0);
      pts.push(1);

      var p = bbox.bezier_point(bezier, pts[0]);
      var maxx = p.x;
      var minx = p.x;
      var maxy = p.y;
      var miny = p.y;
      for(var i = 1; i < pts.length; i++){
        var p = bbox.bezier_point(bezier, pts[i]);
        maxx = Math.max(maxx, p.x);
        minx = Math.min(minx, p.x);
        maxy = Math.max(maxy, p.y);
        miny = Math.min(miny, p.y);
      }

      var box = bbox.cubic_bezier(bezier);

      equal(box.x, minx);
      equal(box.y, miny);
      equal(box.w, maxx - minx);
      equal(box.h, maxy - miny);
    })
  </script>
</html>
